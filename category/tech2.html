<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="utf-8">
    <title>Milestone</title>
    <meta name="description" content="">
    <meta name="author" content="muzi">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
    <script src="../theme/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
    <link href="../theme/bootstrap.min.css" rel="stylesheet">
    <link href="../theme/bootstrap.min.responsive.css" rel="stylesheet">
    <link href="../theme/local.css" rel="stylesheet">
    <link href="../theme/pygments.css" rel="stylesheet">

</head>

<body>

<div class="navbar">
    <div class="navbar-inner">
    <div class="container">

         <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
             <span class="icon-bar"></span>
             <span class="icon-bar"></span>
             <span class="icon-bar"></span>
         </a>

        <a class="brand" href="..">Milestone</a>

        <div class="nav-collapse">

        <ul class="nav">
            
            <li><a href="../pages/about-me.html">About me</a></li>
        </ul>
	<form class="navbar-search pull-right" action="/search.html">
    	<input type="text" class="search-query" placeholder="Search" name="q" id="s">
</form>

        </div>
        
    </div>
    </div>
</div>

<div class="container">
    <div class="content">
    <div class="row">

        <div class="span9">
        

        

 

    <div class='article'>
        <a href="../pages/2016/05/24/ryuwang-luo-shi-yan-tan-ce-ying-yong.html"><h2>Ryu:网络时延探测应用</h2></a>
        <div class= "well small"> 2016-05-24

by <a class="url fn" href="../author/muzi.html">muzi</a>
 


 </div>
        <div class="summary"><p>之前，笔者已经发布了网络感知应用和基于跳数的最短路径转发应用。本文将介绍笔者开发的网络时延探测应用。该应用通过LLDP数据包的时延和Echo数据包的时延计算得出链路的时延数据，从而实现网络链路时延的感知。详细原理和实现步骤将在文章中详细介绍。</p>
<h3>测试原理</h3>
<p>网络时延探测应用利用了Ryu自带的Switches模块的数据，获取到了LLDP数据发送时的时间戳，然后和收到的时间戳进行相减，得到了LLDP数据包从控制器下发到交换机A，然后从交换机A到交换机B，再上报给控制器的时延T1，示例见图1的蓝色箭头。同理反向的时延T2由绿色的箭头组成。此外，控制器到交换机的往返时延由一个蓝色箭头和一个绿色箭头组成，此部分时延由echo报文测试，分别为Ta，Tb。最后链路的前向后向平均时延T=（T1+T2-Ta-Tb）/2。</p>
<p><center><img alt="link delay" src="http://ww1.sinaimg.cn/mw690/7f593341jw1f40i7d39ouj20fr09lgm6.jpg" /></center>
<center>图1. 测量链路时延原理图</center></p>
<h3>获取LLDP时延</h3>
<p>获取T1和T2的逻辑一样，均需要使用到Switches模块的数据。计算LLDP时延的处理逻辑如下代码所示。首先从Packet_in中解析LLDP数据包，获得源DPID，源端口。然后根据发送端口的数据获取到portdata中的发送时间戳数据，并用当下的系统时间减去发送时间戳，得到时延，最后将其保存到graph数据中。</p>
<div class="highlight"><pre>    <span class="nd">@set_ev_cls</span><span class="p">(</span><span class="n">ofp_event</span><span class="o">.</span><span class="n">EventOFPPacketIn</span><span class="p">,</span> <span class="n">MAIN_DISPATCHER</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">packet_in_handler</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ev</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">ev</span><span class="o">.</span><span class="n">msg</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">src_dpid ...</span></pre></div> <a class="btn btn-info xsmall" href="../pages/2016/05/24/ryuwang-luo-shi-yan-tan-ce-ying-yong.html">read more</a></div>
    </div>	
				

 
        

 

    <div class='article'>
        <a href="../pages/2016/05/20/ryuru-he-zai-lldpzhong-tian-jia-zi-ding-yi-lldpdu.html"><h2>Ryu:如何在LLDP中添加自定义LLDPDU</h2></a>
        <div class= "well small"> 2016-05-20

by <a class="url fn" href="../author/muzi.html">muzi</a>
 


 </div>
        <div class="summary"><hr />
<p>在许多实验场景中，都需要使用链路发现协议（LLDP）来发现链路，从而构建网络拓扑。然而LLDP协议不仅仅可以用来发现拓扑，也可以用于时延检测等业务。LLDP通过添加对应的TLV格式的LLDPDU（LLDP数据单元）来携带对应的信息，从而为上层业务提供信息支撑。为实现LLDP数据单元的拓展，本文将以Ryu控制器为例，介绍如何添加自定义的LLDPDU，从而满足多种业务的需求。</p>
<p>添加自定义LLDPDU其实只需修改ryu/lib/packet/lldp.py即可，但是由于该文件仅定义了LLDP的相关类，如何使用还需要其他文件去调用，所以还需要其他的修改步骤。具体步骤将在文章后续介绍。</p>
<h3>修改lldp.py文件</h3>
<p>ryu/lib/packet/lldp.py文件是Ryu控制器中关于LLDP协议数据类的描述，其中定义了如LLDPBasicTLV类等重要的报文类。 以添加发送时间戳的TLV为例，我们需要完成TLV类型号的声明，以及TLV类的定义。</p>
<p>在文件开头处有关于LLDP TLV类型的声明，所以首先我们需要添加一个新的类型：LLDP_TLV_SEND_TIME，其类型号为11。</p>
<div class="highlight"><pre>    <span class="c"># LLDP TLV type</span>
    <span class="n">LLDP_TLV_END</span> <span class="o">=</span> <span class="mi">0</span>                        <span class="c"># End of LLDPDU</span>
    <span class="n">LLDP_TLV_CHASSIS_ID</span> <span class="o">=</span> <span class="mi">1 ...</span></pre></div> <a class="btn btn-info xsmall" href="../pages/2016/05/20/ryuru-he-zai-lldpzhong-tian-jia-zi-ding-yi-lldpdu.html">read more</a></div>
    </div>	
				

 
        

 

    <div class='article'>
        <a href="../pages/2016/05/03/wo-shi-ge-sdnjiao-huan-ji.html"><h2>我是一个SDN交换机</h2></a>
        <div class= "well small"> 2016-05-03

by <a class="url fn" href="../author/muzi.html">muzi</a>
 


 </div>
        <div class="summary"><p>我叫阿飞，是大柳树村的快递小哥。阿飞是大家给我起的名字，因为我送货很快。</p>
<p>我做着普通的工作，拿着普通的工资，没有房子，一直单身，但我知道，只要努力，就能出人头地。要知道，在因特奈特国，识字的人并不是很多。幸亏我还认得一些字，才能成为一名光荣的快递员。很多时候，人们叫我交换机，因为我每天都像机器一样交换着包裹。其他快递元也和我一样机械地交换货物，但我知道：我和外地的快递员不一样。我一直知道。</p>
<p>我和其他的金银岛上的快递员们都学过OpenFlow等软件定义网络（SDN）方向的语言，拿的是SDN专业方向的文凭，但那些岛外的快递员前辈们都是传统的快递员，没有学过方面的知识。那时候没有SDN专业方向，所以他们都需要学OSPF、IS-IS等多种传统语言。而我们只需要学会OpenFlow语言基本就可以上岗了。虽然我们学习的内容减少了，但是我们却需要SDN控制器来指挥快递的转发。</p>
<p>之所以现在出现SDN方向是因为传统的工作模式已经固化，难以应付更多的新业务。一方面，快递员要学习的知识太多，需要学习好多语言才能成为一名光荣的传统快递员，所以学习压力很大，而且学费也太贵。另一方面是传统的语言并没有办法沟通出全局的物流信息，导致有时候快递转发效率太低了。但是在SDN的专业方向里面，快递主管拥有全局的物流信息，通过快递主管管理快递员，告诉我们怎么收发，就可以做到全局的掌控，优化传输效率 ...</p> <a class="btn btn-info xsmall" href="../pages/2016/05/03/wo-shi-ge-sdnjiao-huan-ji.html">read more</a></div>
    </div>	
				

 
        

 

    <div class='article'>
        <a href="../pages/2016/04/18/wo-shi-ge-sdnkong-zhi-qi.html"><h2>我是一个SDN控制器</h2></a>
        <div class= "well small"> 2016-04-18

by <a class="url fn" href="../author/muzi.html">muzi</a>
 


 </div>
        <div class="summary"><p>“醒醒！”， 朦胧中有一个人叫醒了我。“跟我走”，那个身穿linux制服的胖得像企鹅一样的大叔拉着我就走。“你谁啊？去哪里?”我惊恐的问。“我是操作系统，我负责给你安排工作。你是一个SDN控制器，是Ryu族人，就给你分配代号9527吧，凭着这代号你可以得到很多资源，从而帮助你完成工作。”那大叔显得有些不耐烦地回答。</p>
<p>“看到没有，前面办公楼里的6633房间就是你的办公室，你的工作就是处理信件和包裹，会有门房大爷给你收发信件，你记得找他取信就可以了，过期他会丢掉的。”操作系统大叔边走边说，一转眼已经到了门口。门房果然有一个大爷，那包裹已经堆积如山了，胸口上沾了好多灰尘的工作证都来不及擦拭，不过隐隐约约还是可以看出上面写着“网卡”两个字。</p>
<p>“哦，谢谢大哥。” 我突然反应过来，加快脚步跟上操作系统的步伐。但我依然不知道我来这里是做什么的，周围都好陌生。对未知未来的迷茫与彷徨，让我忍不住问操作系统大哥，“操作系统大哥，我来这里干什么啊？”  “你这么叫不累？叫我linux就好了。你是新来的员工，做什么你可以看看你胸前的说明书”。</p>
<p>我低头一看，我的天啊，我贴着这么大的说明书走过来三条街，还和5个美女打了招呼，我以为他们觉得我帅才对我笑，太丢人了！我拿下说明书才发现上面赫然写着 ...</p> <a class="btn btn-info xsmall" href="../pages/2016/04/18/wo-shi-ge-sdnkong-zhi-qi.html">read more</a></div>
    </div>	
				

 
        

 

    <div class='article'>
        <a href="../pages/2016/03/23/p4zhen-zheng-de-sdnhuan-yao-yuan-ma.html"><h2>P4:真正的SDN还遥远吗</h2></a>
        <div class= "well small"> 2016-03-23

by <a class="url fn" href="../author/muzi.html">muzi</a>
 


 </div>
        <div class="summary"><p>OpenFlow协议作为SDN最流行的南向协议，得到了很多的关注，目前发展也良好，但OpenFlow并不完美，OpeFlow交换机还不能提供更好的可编程能力。P4作为新的网络编程语言很好的弥补这个缺陷。P4会改变网络吗？是否能带来具有完全可编程能力的SDN？还是仅仅是学术界的宠儿？本文将介绍协议独立数据包处理编程语言P4，其中包括其简介、原理和发展趋势，希望笔者能带来一些有意思的观点。</p>
<h3>简介</h3>
<p>P4(Programming protocol-independent packet processors)[1]是由Pat Bosshart等人提出来的高级“协议独立数据包处理编程语言”，如OpenFlow一样是一种南向协议，但是其范围要比OpenFlow要大。不仅可以指导数据流进行转发，还可以对交换机等转发设备的数据处理流程进行软件编程定义，是真正意义上的完全SDN。值得注意的是，P4论文作者中还有斯坦福大学的Nick McKeown教授和普林斯顿大学的Jennifer Rexford教授两位业界大牛的名字。Nick教授是SDN的提出者之一，一直是SDN学术领域顶尖的存在；而后者Jennifer教授也发表了4D[2]等诸多重要的SDN相关论文，更提出了网络编程语言Frenetic[3]，同样是业界的先驱。两位教授也是P4组织的主要推动者之一。目前，P4语言作为一种潜在的OpenFlow2.0的发展方向在努力发展。</p>
<h3>原理</h3>
<p>与POF提出的目的类似，P4提出的目的也是为了解决OpenFlow编程能力不足以及其设计本身所带来的可拓展性差的难题。自OpenFlow1.0发布以来，其版本目前已经演进到1 ...</p> <a class="btn btn-info xsmall" href="../pages/2016/03/23/p4zhen-zheng-de-sdnhuan-yao-yuan-ma.html">read more</a></div>
    </div>	
				
<div class="pagination">
<ul>
    <li class="prev"><a href="../category/tech.html">&larr; Previous</a></li>

    <li class=""><a href="../category/tech.html">1</a></li>
    <li class="active"><a href="../category/tech2.html">2</a></li>
    <li class=""><a href="../category/tech3.html">3</a></li>
    <li class=""><a href="../category/tech4.html">4</a></li>
    <li class=""><a href="../category/tech5.html">5</a></li>
    <li class=""><a href="../category/tech6.html">6</a></li>
    <li class=""><a href="../category/tech7.html">7</a></li>
    <li class=""><a href="../category/tech8.html">8</a></li>
    <li class=""><a href="../category/tech9.html">9</a></li>
    <li class=""><a href="../category/tech10.html">10</a></li>
    <li class=""><a href="../category/tech11.html">11</a></li>
    <li class=""><a href="../category/tech12.html">12</a></li>
    <li class=""><a href="../category/tech13.html">13</a></li>
    <li class=""><a href="../category/tech14.html">14</a></li>
    <li class=""><a href="../category/tech15.html">15</a></li>

    <li class="next"><a href="../category/tech3.html">Next &rarr;</a></li>

</ul>
</div>
 
  
        </div>
        
        <div class="span3">

            <div class="well" style="padding: 8px 0; background-color: #FBFBFB;">
            <ul class="nav nav-list">
                <li class="nav-header"> 
                Site
                </li>
            
                <li><a href="../archives.html">Archives</a>
                <li><a href="../tags.html">Tags</a>
                <!-- <li><a href="http://www.muzixing.com/" rel="alternate">Atom feed</a> -->
		</li>
                <li><a href="http://www.muzixing.com/feeds/all.rss.xml" rel="alternate">RSS feed</a></li>
            </ul>
            </div>


            <div class="well" style="padding: 8px 0; background-color: #FBFBFB;">
            <ul class="nav nav-list">
                <li class="nav-header"> 
                Categories
                </li>
                
                <li><a href="../category/life.html">Life</a></li>
                <li><a href="../category/tech.html">Tech</a></li>
                   
            </ul>
            </div>


            <div class="well" style="padding: 8px 0; background-color: #FBFBFB;">
            <ul class="nav nav-list">
                <li class="nav-header"> 
                Links
                </li>
            
                <li><a href="http://www.sdnlab.com/">SDNLAB</a></li>
                <li><a href="http://www.sdnap.com/">SDNAP</a></li>
                <li><a href="http://www.richardzhao.me/">Richardzhao</a></li>
                <li><a href="http://ikimi.net/">Kimi Yang</a></li>
                <li><a href="http://milestones.lofter.com/">Milestones</a></li>
            </ul>
            </div>


            <div class="social">
            <div class="well" style="padding: 8px 0; background-color: #FBFBFB;">
            <ul class="nav nav-list">
                <li class="nav-header"> 
                Social
                </li>
           
                <li><a href="https://github.com/muzixing">Github</a></li>
                <li><a href="http://weibo.com/u/2136552257">Weibo</a></li>
                <li><a href="https://www.linkedin.com/in/cheng-li-0b612394">Linkedin</a></li>
                <li><a href="http://350959853.qzone.qq.com">Qzone</a></li>
            </ul>
            </div>
            </div>

        </div>  
    </div>     </div> 
<footer>
<br />
<p><a href="..">Milestone</a> &copy; muzi 2012</p>
</footer>

</div> <!-- /container -->
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
<script src="http://twitter.github.com/bootstrap/assets/js/bootstrap-collapse.js"></script>
<script>var _gaq=[['_setAccount','UA-45955656-1'],['_trackPageview']];(function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];g.src='//www.google-analytics.com/ga.js';s.parentNode.insertBefore(g,s)}(document,'script'))</script>
 
</body>
</html>