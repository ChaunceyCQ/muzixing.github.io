<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="utf-8">
    <title>Milestone</title>
    <meta name="description" content="">
    <meta name="author" content="muzi">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
    <script src="../theme/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
    <link href="../theme/bootstrap.min.css" rel="stylesheet">
    <link href="../theme/bootstrap.min.responsive.css" rel="stylesheet">
    <link href="../theme/local.css" rel="stylesheet">
    <link href="../theme/pygments.css" rel="stylesheet">

</head>

<body>

<div class="navbar">
    <div class="navbar-inner">
    <div class="container">

         <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
             <span class="icon-bar"></span>
             <span class="icon-bar"></span>
             <span class="icon-bar"></span>
         </a>

        <a class="brand" href="..">Milestone</a>

        <div class="nav-collapse">

        <ul class="nav">
            
            <li><a href="../pages/about-me.html">About me</a></li>
        </ul>
	<form class="navbar-search pull-right" action="/search.html">
    	<input type="text" class="search-query" placeholder="Search" name="q" id="s">
</form>

        </div>
        
    </div>
    </div>
</div>

<div class="container">
    <div class="content">
    <div class="row">

        <div class="span9">
        

        


    <div class='article'>
        <div class="content-title">
            <a href="../pages/2016/08/30/getting-started-of-mongodb.html"><h1>Getting Started of MongoDB</h1></a>
2016-08-30

by <a class="url fn" href="../author/muzi.html">muzi</a>
 


 
        </div>
        
        <div><h3>What is MongoDB</h3>
<p>MongoDB is an open-source document database that provides high performance, high availability, and automatic scaling.[1]</p>
<p>MongoDB（来自于英文单词“Humongous”，中文含义为“庞大”）是可以应用于各种规模的企业、各个行业以及各类应用程序的开源数据库。作为一个适用于敏捷开发的数据库，MongoDB的数据模式可以随着应用程序的发展而灵活地更新。与此同时，它也为开发人员 提供了传统数据库的功能：二级索引，完整的查询系统以及严格一致性等等。 MongoDB能够使企业更加具有敏捷性和可扩展性，各种规模的企业都可以通过使用MongoDB来创建新的应用，提高与客户之间的工作效率，加快产品上市时间，以及降低企业成本。</p>
<p>MongoDB是专为可扩展性，高性能和高可用性而设计的数据库。它可以从单服务器部署扩展到大型、复杂的多数据中心架构。利用内存计算的优势，MongoDB能够提供高性能的数据读写操作。 MongoDB的本地复制和自动故障转移功能使您的应用程序具有企业级的可靠性和操作灵活性。[2]</p>
<h3>About MongoDB</h3>
<p>MongoDB is a No-SQL database. MongoDB server can maintain some databases, each database can maintain many collections. Collection is a concept like table in SQL database. Each Collection contain many documents. Each Document is a Json style object, which has many 'key':'value' pairs. For easy under stand, a table refered from [3] shows below.</p>
<table class="table-bordered table-striped table-condensed">
<tbody><tr>
<th>SQL Term/Concept</th>
<th>MongoDB Term/Concept</th>
<th>Description</th>
</tr>
<tr>
<td>database</td>
<td>database</td>
<td>数据库</td>
</tr>
<tr>
<td>table</td>
<td>collection</td>
<td>数据库表/集合</td>
</tr>
<tr>
<td>row</td>
<td>document</td>
<td>数据记录行/文档</td>
</tr>
<tr>
<td>column</td>
<td>field</td>
<td>数据字段/域</td>
</tr>
<tr>
<td>index</td>
<td>index</td>
<td>索引</td>
</tr>
<tr>
<td>table joins</td>
<td>&nbsp;</td>
<td>表连接,MongoDB不支持</td>
</tr>
<tr>
<td>primary key</td>
<td>primary key</td>
<td>主键,MongoDB自动将_id字段设置为主键</td>
</tr>
</tbody></table>

<h3>Install MongoDB</h3>
<p>For Mac OS, MongoDB can be installed by using command[4]:</p>
<div class="highlight"><pre>    <span class="n">brew</span> <span class="n">install</span> <span class="n">mongodb</span>
</pre></div>


<p>if you want to install MongoDB with supporting TSL/SSL:</p>
<div class="highlight"><pre>    <span class="n">brew</span> <span class="n">install</span> <span class="n">mongodb</span> <span class="o">--</span><span class="n">with</span><span class="o">-</span><span class="n">openssl</span>
</pre></div>


<h3>Install Pymongo</h3>
<p>To use MongDB by Python, you still need to install pymongo</p>
<div class="highlight"><pre>    <span class="n">pip</span> <span class="n">install</span> <span class="n">pymongo</span>
</pre></div>


<p>if you use Python3, please use pip3 to install pymongo</p>
<h3>Use MongoDB by CLI</h3>
<p>After installing MonogoDB, you can start MongoDB by[5]:</p>
<div class="highlight"><pre>    ./mongo
</pre></div>


<p>Because the CLI is a JavaScript shell, so you can execute code with it. For example, you can do some easy calculation.</p>
<div class="highlight"><pre>    &gt;1+2
    &gt;3
</pre></div>


<h4>List database</h4>
<div class="highlight"><pre>    &gt; show dbs
    <span class="nb">local  </span>0.000GB
    <span class="nb">test   </span>0.000GB
</pre></div>


<h4>Use database</h4>
<div class="highlight"><pre>    &gt; use <span class="nb">test</span>
<span class="nb">    </span>switched to db <span class="nb">test</span>    
</pre></div>


<h4>Show database name of which is using</h4>
<div class="highlight"><pre>    &gt;db
    <span class="nb">test</span>
</pre></div>


<h4>Create database</h4>
<p>You can enter 'use database_name' to create a new database, if the database name is not existed.</p>
<div class="highlight"><pre>    &gt; use milestone
    switched to db milestone
</pre></div>


<p>Only when you add some documents into dababase's collection, can you see the database name by using 'show dbs'. However you can use 'db' to show the using database.</p>
<h4>List collections</h4>
<div class="highlight"><pre>    show collections
</pre></div>


<h4>Create collection</h4>
<p>You can use createCollection method to create a collection for databse.</p>
<div class="highlight"><pre>    &gt; show collections
    &gt; db.createCollection<span class="o">(</span><span class="s2">&quot;muzixing&quot;</span>,<span class="o">{</span>size:100000<span class="o">})</span>
    <span class="o">{</span> <span class="s2">&quot;ok&quot;</span> : 1 <span class="o">}</span>
    &gt; show collections
    muzixing
    &gt; 
</pre></div>


<h4>Remove collection</h4>
<div class="highlight"><pre>    db.collection_name.drop<span class="o">()</span>
</pre></div>


<h4>Add document into collection</h4>
<p>You can insert data by insert method:</p>
<div class="highlight"><pre>    &gt; db.muzixing.insert<span class="o">({</span><span class="s2">&quot;name&quot;</span>:<span class="s2">&quot;www.muzixing.com&quot;</span><span class="o">})</span>
    WriteResult<span class="o">({</span> <span class="s2">&quot;nInserted&quot;</span> : 1 <span class="o">})</span>
    &gt;
</pre></div>


<h4>Search document</h4>
<p>Use find() method to find all documents or fill parameter to select documents.</p>
<div class="highlight"><pre>    &gt; db.muzixing.find<span class="o">()</span>
    <span class="o">{</span> <span class="s2">&quot;_id&quot;</span> : ObjectId<span class="o">(</span><span class="s2">&quot;57c6102b4366cfc975563b94&quot;</span><span class="o">)</span>, <span class="s2">&quot;name&quot;</span> : <span class="s2">&quot;www.muzixing.com&quot;</span> <span class="o">}</span>
    <span class="o">{</span> <span class="s2">&quot;_id&quot;</span> : ObjectId<span class="o">(</span><span class="s2">&quot;57c611d24366cfc975563b95&quot;</span><span class="o">)</span>, <span class="s2">&quot;name&quot;</span> : <span class="s2">&quot;chengli&quot;</span> <span class="o">}</span>
    <span class="o">{</span> <span class="s2">&quot;_id&quot;</span> : ObjectId<span class="o">(</span><span class="s2">&quot;57c611d94366cfc975563b96&quot;</span><span class="o">)</span>, <span class="s2">&quot;name&quot;</span> : <span class="s2">&quot;milestone&quot;</span> <span class="o">}</span>
    &gt; 
    &gt; db.muzixing.find<span class="o">({</span><span class="s1">&#39;name&#39;</span>:<span class="s1">&#39;www.muzixing.com&#39;</span><span class="o">})</span>
    <span class="o">{</span> <span class="s2">&quot;_id&quot;</span> : ObjectId<span class="o">(</span><span class="s2">&quot;57c6102b4366cfc975563b94&quot;</span><span class="o">)</span>, <span class="s2">&quot;name&quot;</span> : <span class="s2">&quot;www.muzixing.com&quot;</span> <span class="o">}</span>
    &gt; 
</pre></div>


<p>Also, findOne method can be use to get one document.</p>
<div class="highlight"><pre>    &gt; db.muzixing.findOne<span class="o">()</span>
    <span class="o">{</span> <span class="s2">&quot;_id&quot;</span> : ObjectId<span class="o">(</span><span class="s2">&quot;57c6102b4366cfc975563b94&quot;</span><span class="o">)</span>, <span class="s2">&quot;name&quot;</span> : <span class="s2">&quot;www.muzixing.com&quot;</span> <span class="o">}</span>
    &gt; db.muzixing.find<span class="o">()</span>
    <span class="o">{</span> <span class="s2">&quot;_id&quot;</span> : ObjectId<span class="o">(</span><span class="s2">&quot;57c6102b4366cfc975563b94&quot;</span><span class="o">)</span>, <span class="s2">&quot;name&quot;</span> : <span class="s2">&quot;www.muzixing.com&quot;</span> <span class="o">}</span>
    <span class="o">{</span> <span class="s2">&quot;_id&quot;</span> : ObjectId<span class="o">(</span><span class="s2">&quot;57c611d24366cfc975563b95&quot;</span><span class="o">)</span>, <span class="s2">&quot;name&quot;</span> : <span class="s2">&quot;chengli&quot;</span> <span class="o">}</span>
    <span class="o">{</span> <span class="s2">&quot;_id&quot;</span> : ObjectId<span class="o">(</span><span class="s2">&quot;57c611d94366cfc975563b96&quot;</span><span class="o">)</span>, <span class="s2">&quot;name&quot;</span> : <span class="s2">&quot;milestone&quot;</span> <span class="o">}</span>
    &gt; 
</pre></div>


<h4>Update document</h4>
<p>Update command's syntax shows below:</p>
<div class="highlight"><pre>    db.collection.update<span class="o">(</span>
       &lt;query&gt;,
       &lt;update&gt;,
       <span class="o">{</span>
         upsert: &lt;boolean&gt;,
         multi: &lt;boolean&gt;,
         writeConcern: &lt;document&gt;
       <span class="o">}</span>
    <span class="o">)</span>
</pre></div>


<p>For example:</p>
<div class="highlight"><pre>    &gt; db.muzixing.update<span class="o">({</span><span class="s2">&quot;name&quot;</span>:<span class="s2">&quot;licheng&quot;</span><span class="o">}</span>,<span class="o">{</span><span class="nv">$set</span>:<span class="o">{</span><span class="s2">&quot;name&quot;</span>:<span class="s2">&quot;chengli&quot;</span><span class="o">}})</span>
    WriteResult<span class="o">({</span> <span class="s2">&quot;nMatched&quot;</span> : 0, <span class="s2">&quot;nUpserted&quot;</span> : 0, <span class="s2">&quot;nModified&quot;</span> : 0 <span class="o">})</span>

    &gt; db.muzixing.find<span class="o">()</span>
    <span class="o">{</span> <span class="s2">&quot;_id&quot;</span> : ObjectId<span class="o">(</span><span class="s2">&quot;57c615564366cfc975563b97&quot;</span><span class="o">)</span>, <span class="s2">&quot;name&quot;</span> : <span class="s2">&quot;chengli&quot;</span>, <span class="s2">&quot;face&quot;</span> : <span class="s2">&quot;handsome&quot;</span> <span class="o">}</span>

    &gt; db.muzixing.update<span class="o">({</span><span class="s2">&quot;name&quot;</span>:<span class="s2">&quot;chengli&quot;</span><span class="o">}</span>,<span class="o">{</span><span class="nv">$set</span>:<span class="o">{</span><span class="s2">&quot;name&quot;</span>:<span class="s2">&quot;licheng&quot;</span><span class="o">}})</span>
    WriteResult<span class="o">({</span> <span class="s2">&quot;nMatched&quot;</span> : 1, <span class="s2">&quot;nUpserted&quot;</span> : 0, <span class="s2">&quot;nModified&quot;</span> : 1 <span class="o">})</span>

    &gt; db.muzixing.find<span class="o">()</span>
    <span class="o">{</span> <span class="s2">&quot;_id&quot;</span> : ObjectId<span class="o">(</span><span class="s2">&quot;57c615564366cfc975563b97&quot;</span><span class="o">)</span>, <span class="s2">&quot;name&quot;</span> : <span class="s2">&quot;licheng&quot;</span>, <span class="s2">&quot;face&quot;</span> : <span class="s2">&quot;handsome&quot;</span> <span class="o">}</span>
    &gt; 
</pre></div>


<h3>Remove document</h3>
<p>Syntax shows below</p>
<div class="highlight"><pre>    db.collection.remove<span class="o">(</span>
       &lt;query&gt;,
       &lt;justOne&gt;
    <span class="o">)</span>
</pre></div>


<p>For example:</p>
<div class="highlight"><pre>    <span class="o">&gt;</span> <span class="n">db</span><span class="o">.</span><span class="n">muzixing</span><span class="o">.</span><span class="n">find</span><span class="p">()</span>
    <span class="p">{</span> <span class="s">&quot;_id&quot;</span> <span class="p">:</span> <span class="n">ObjectId</span><span class="p">(</span><span class="s">&quot;57c615564366cfc975563b97&quot;</span><span class="p">),</span> <span class="s">&quot;name&quot;</span> <span class="p">:</span> <span class="s">&quot;licheng&quot;</span><span class="p">,</span> <span class="s">&quot;face&quot;</span> <span class="p">:</span> <span class="s">&quot;handsome&quot;</span> <span class="p">}</span>
    <span class="p">{</span> <span class="s">&quot;_id&quot;</span> <span class="p">:</span> <span class="n">ObjectId</span><span class="p">(</span><span class="s">&quot;57c617694366cfc975563b98&quot;</span><span class="p">),</span> <span class="s">&quot;name&quot;</span> <span class="p">:</span> <span class="s">&quot;girl friend&quot;</span><span class="p">,</span> <span class="s">&quot;face&quot;</span> <span class="p">:</span> <span class="s">&quot;beautiful&quot;</span> <span class="p">}</span>
    <span class="o">&gt;</span> <span class="n">db</span><span class="o">.</span><span class="n">muzixing</span><span class="o">.</span><span class="n">remove</span><span class="p">({</span><span class="s">&#39;name&#39;</span><span class="p">:</span><span class="s">&quot;licheng&quot;</span><span class="p">})</span>
    <span class="n">WriteResult</span><span class="p">({</span> <span class="s">&quot;nRemoved&quot;</span> <span class="p">:</span> <span class="mi">1</span> <span class="p">})</span>
    <span class="o">&gt;</span> <span class="n">db</span><span class="o">.</span><span class="n">muzixing</span><span class="o">.</span><span class="n">find</span><span class="p">()</span>
    <span class="p">{</span> <span class="s">&quot;_id&quot;</span> <span class="p">:</span> <span class="n">ObjectId</span><span class="p">(</span><span class="s">&quot;57c617694366cfc975563b98&quot;</span><span class="p">),</span> <span class="s">&quot;name&quot;</span> <span class="p">:</span> <span class="s">&quot;girl friend&quot;</span><span class="p">,</span> <span class="s">&quot;face&quot;</span> <span class="p">:</span> <span class="s">&quot;beautiful&quot;</span> <span class="p">}</span>
    <span class="o">&gt;</span> 
</pre></div>


<p>For more info of learning MongoDB for Chinese, see <a href="http://www.runoob.com/mongodb/mongodb-tutorial.html">MongoDB tutorial. </a></p>
<p>For English speaker, see <a href="https://docs.mongodb.com/">MongoDB Docs.</a>and <a href="http://www.tutorialspoint.com/mongodb/index.htm">tutorialspoint-MongoDB</a></p>
<h3>Pymongo</h3>
<p>Actually, people always use some coding language libs to use MongoDB instead of CLI. After learning MongoDB and CLI usage, it is completely easy to understand how to use pymongo to manipulate MongoDB[7]. </p>
<p>First of all, you should start a MongoDB server, such as we can start MongoDB at localhost, the default port of MongoDB is 27017.</p>
<p>Example shows below:</p>
<div class="highlight"><pre>    <span class="kn">import</span> <span class="nn">pymongo</span>
    <span class="kn">from</span> <span class="nn">pymongo</span> <span class="kn">import</span> <span class="n">MongoClient</span>


    <span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&quot;__main__&quot;</span><span class="p">:</span>
        <span class="c"># get client</span>
        <span class="n">client</span> <span class="o">=</span> <span class="n">MongoClient</span><span class="p">(</span><span class="s">&#39;mongodb://localhost:27017/&#39;</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;client&quot;</span><span class="p">,</span> <span class="n">client</span><span class="p">)</span>

        <span class="c"># get database, if the database has existed.Otherwise, create it</span>
        <span class="n">db</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">test</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;db:&quot;</span><span class="p">,</span> <span class="n">db</span><span class="p">)</span>

        <span class="c"># get collection, if it has existed, otherwise, create it.</span>
        <span class="n">collection</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">chengli</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;collection name&quot;</span><span class="p">,</span> <span class="n">db</span><span class="o">.</span><span class="n">collection_names</span><span class="p">())</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;collection: &quot;</span><span class="p">,</span> <span class="n">collection</span><span class="p">)</span>

        <span class="c"># get document</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;find one: &#39;</span><span class="p">,</span> <span class="n">collection</span><span class="o">.</span><span class="n">find_one</span><span class="p">())</span>

        <span class="c"># post data item</span>
        <span class="n">new_man</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;age&#39;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="s">&#39;oo&#39;</span><span class="p">,</span> <span class="s">&#39;sex&#39;</span><span class="p">:</span> <span class="s">&#39;male&#39;</span><span class="p">,</span> <span class="s">&#39;id&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">}</span>
        <span class="n">collection</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">new_man</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="n">collection</span><span class="o">.</span><span class="n">find</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">())</span>

        <span class="c"># get multi items</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">collection</span><span class="o">.</span><span class="n">find</span><span class="p">():</span>
            <span class="k">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

        <span class="c"># find data</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">collection</span><span class="o">.</span><span class="n">find_one</span><span class="p">({</span><span class="s">&#39;name&#39;</span><span class="p">:</span><span class="s">&quot;chengli&quot;</span><span class="p">})</span>
        <span class="k">print</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">])</span>

        <span class="c"># update data</span>
        <span class="n">collection</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s">&#39;name&#39;</span><span class="p">:</span><span class="s">&#39;haha&#39;</span><span class="p">},{</span><span class="s">&#39;$set&#39;</span><span class="p">:{</span><span class="s">&#39;title&#39;</span><span class="p">:</span><span class="s">&#39;employee&#39;</span><span class="p">}})</span>
        <span class="n">collection</span><span class="o">.</span><span class="n">remove</span><span class="p">({</span><span class="s">&#39;title&#39;</span><span class="p">:</span><span class="s">&#39;employee&#39;</span><span class="p">})</span>
        <span class="n">collection</span><span class="o">.</span><span class="n">create_index</span><span class="p">([(</span><span class="s">&#39;age&#39;</span><span class="p">,</span><span class="n">pymongo</span><span class="o">.</span><span class="n">ASCENDING</span><span class="p">),])</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">collection</span><span class="o">.</span><span class="n">find</span><span class="p">()</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="s">&#39;age&#39;</span><span class="p">,</span> <span class="n">pymongo</span><span class="o">.</span><span class="n">ASCENDING</span><span class="p">):</span>
            <span class="k">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</pre></div>


<p><strong>Note that</strong></p>
<ul>
<li>
<p>This is Python3 code.</p>
</li>
<li>
<p>Some code is Non-idempotent, such as insert data and remove data, so different results will generate when run code in different round.</p>
</li>
</ul>
<p>More info of pymongo, see <a href="http://api.mongodb.com/python/current/tutorial.html">Mongo API Doc</a>.</p>
<h3>References</h3>
<p>[1]https://www.mongodb.com</p>
<p>[2]https://www.mongodb.com/cn</p>
<p>[3]http://www.runoob.com/mongodb/mongodb-databases-documents-collections.html</p>
<p>[4]https://docs.mongodb.com/manual/installation/</p>
<p>[5]http://www.runoob.com/mongodb/mongodb-linux-install.html</p>
<p>[7]http://wiki.jikexueyuan.com/project/start-learning-python/232.html</p></div>
        <hr />
    </div>
		

 
        

 

    <div class='article'>
        <a href="../pages/2016/07/26/wo-shi-zen-yao-diu-diao-fan-wan-de.html"><h2>我是怎么丢掉饭碗的</h2></a>
        <div class= "well small"> 2016-07-26

by <a class="url fn" href="../author/muzi.html">muzi</a>
 


 </div>
        <div class="summary"><p>我出门名门，骨骼精奇，身怀绝迹，独步武林多年，凭着祖传的无影手和行走江湖多年练就的一套安检基本法，我房霍强当上了桃花镇的城门护卫队的队长，也算不负家族期望。</p>
<p>桃花镇自古以来就是兵家必争之地，又有许多桃花盛开，所以也是一个远近闻名的旅游胜地。为保证桃花镇的安全，又要保证桃花镇的游客流量，我房某人必须要快速地做好安检工作。多亏我祖传的无影手绝技和总结的安检基本法，我才能应对每天如此多的人流。</p>
<p>身居要位的我身价自然不会太低，多少也要个20W年薪吧。我要价高也是有道理的，自古以来，能做安检工作的都是像我这样骨骼精奇又身怀绝学的人，软硬实力俱佳啊。先说软实力，我行走江湖十余载，见过采花、毛贼、刺客少说上百，多了上千，早已掌握了一套基本法，练就了一副火眼金睛，一眼就能看出蹊跷。只要学会了这套安检基本法，就可以做到像我这样的火眼金睛。硬实力上，与普通骨架的人不同，我们家族的人骨骼精奇，手速极快，有无影手之称。无影手是我们家族的祖传技能，到我已经19代有余。即使软件方面其他人可以做到，但是别人做不到我的速度，所以我身价才这么高。</p>
<p>事业成功不算什么，我房霍强还是和镇长女儿慕容翠花定了亲的男人，那可是要迎娶白富美的节奏。</p>
<p>我的工作内容无非就是禁止一些黑名单上的人进城，限制人流等等，早已轻车熟路。我还可以防止DoS恶意攻击。比如有时会有同一拨人在不断假装去桃花庙上香 ...</p> <a class="btn btn-info xsmall" href="../pages/2016/07/26/wo-shi-zen-yao-diu-diao-fan-wan-de.html">read more</a></div>
    </div>	
				

 
        

 

    <div class='article'>
        <a href="../pages/2016/07/08/ji-yu-tiao-shu-shi-yan-dai-kuan-de-zui-duan-you-lu-jing-he-fu-zai-jun-heng.html"><h2>基于跳数\时延\带宽的最短/优路径和负载均衡</h2></a>
        <div class= "well small"> 2016-07-08

by <a class="url fn" href="../author/muzi.html">muzi</a>
 


 </div>
        <div class="summary"><p>对于SDN初学者而言，最短路径转发应用和负载均衡应用是最常见，也是最适合学习的经典应用。根据链路权重参数的不同，主要有基于跳数、时延和带宽的几种最短\最优路径转发应用。根据链路可用带宽实现的最优路径转发本质上也是一种网络流量负载均衡的简单实现。本文将介绍笔者在学习过程中开发的网络感知模块以及基于跳数、时延和带宽三种最优路径转发应用。</p>
<h3>基于跳数的最短路径转发</h3>
<p>基于跳数的最短路径转发是最简单的最优路径转发应用。我们通过<a href="https://github.com/muzixing/ryu/blob/master/ryu/app/network_awareness/network_awareness.py">network_awareness</a>应用来实现网络拓扑资源的感知并计算最短路径。首先控制器通过下发LLDP报文来获取网络链路信息，然后再利用网络信息，生成网络拓扑图。网络感知应用使用networkx的有向图数据结构存储拓扑信息，使用networkx提供的<a href="http://networkx.readthedocs.io/en/stable/reference/generated/networkx.algorithms.simple_paths.shortest_simple_paths.html">shortest_simple_paths</a>函数来计算最短路径。shortest_simple_paths函数支持在图上找出源交换机到目的交换机的K条最短路径，其函数参数信息如下：</p>
<div class="highlight"><pre><span class="n">shortest_simple_paths</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="n">None</span><span class="p">)</span>
</pre></div>


<p>在给定图G，源交换机source，目的交换机target以及链路权重类型weight的情况下，会返回一个路径生成器。通过K次调用生成器可以生成K条最短路径。</p>
<p>获得最短路径之后，<a href="https://github.com/muzixing/ryu/blob/master/ryu/app/network_awareness/shortest_forwarding.py">shortest_forwarding</a>应用将完成流表下发等工作，实现基于跳数的最短路径转发应用。</p>
<h3>基于时延的最优路径转发</h3>
<p>基于时延的最优路径转发应用原理和基于跳数的最短路径转发应用类似，只是链路权重类型变成了时延。关于计算链路时延的原理，读者可以阅读<a href="http://www.muzixing.com/pages/2016/05/24/ryuwang-luo-shi-yan-tan-ce-ying-yong.html">Ryu:网络时延探测应用</a>。<a href="https://github.com/muzixing/ryu/blob/master/ryu/app/network_awareness/network_delay_detector.py">Network_Delay_Detector</a>是一个网络时延探测应用，其在获取到链路时延之后，将时延数据存储到Networkx的图数据结构中 ...</p> <a class="btn btn-info xsmall" href="../pages/2016/07/08/ji-yu-tiao-shu-shi-yan-dai-kuan-de-zui-duan-you-lu-jing-he-fu-zai-jun-heng.html">read more</a></div>
    </div>	
				

 
        

 

    <div class='article'>
        <a href="../pages/2016/06/28/sdnzui-xin-yan-jiu-jin-zhan.html"><h2>SDN最新研究进展</h2></a>
        <div class= "well small"> 2016-06-28

by <a class="url fn" href="../author/muzi.html">muzi</a>
 


 </div>
        <div class="summary"><p>自SDN出现以来，关于SDN的研究一直没有停止，只是不同的阶段关于SDN的研究的重点不同。比如最开始的时候，探讨最多的是SDN的可行性，以及如何将SDN应用到对应的网络场景中。本文是笔者在最近阅读2015年至今的若干SDN论文后总结的SDN最新研究进展，希望对读者提供一些帮助。</p>
<h3>SDN/NFV</h3>
<p>SDN和NFV都是当下网络界研究的热点，而如何将两者整合部署，也是研究的热点之一。设计SDN/NFV整合部署框架的研究是这个研究方向的主要研究切入点之一，比如参考文献[1]中就提出了一个SDN/NFV的整体架构。框架中的NFV协调器可以和云管理平台配合使用，SDN控制器也支持与云平台结合。由于此类方案是SDN与其他技术/框架的集合，本身没有太多创新性，论文中也仅仅介绍了其实现方案，所以此处不加赘述。</p>
<p>SDN/NFV结合还可以部署在很多场景，比如WiFi场景。OpenSDWN[2]就是一种软件定义的家庭/企业WiFi架构框架。 将SDN与其他技术结合并应用在特定网络场景是一种主要的研究方向之一。</p>
<h3>流表优化</h3>
<p>OpenFlow所支持的细粒度流管理是SDN最大的优势之一，但是细粒度的管理是需要付出代价的。为满足细粒度的管理，则需要更粒度的流表项。但是像OpenFlow协议这种细粒度的管理会带来一定的时延，对于时延敏感的短流业务而言，这个时延带来的影响是不可忽视的，这很可能会抵消了SDN带来的好处。所以如何通过流表来匹配流，从而减少流表项下发次数，是降低时延影响的有利手段。</p>
<p>此外，当网络流数目过多时，交换机的流表空间就无法满足需求。当流表满时 ...</p> <a class="btn btn-info xsmall" href="../pages/2016/06/28/sdnzui-xin-yan-jiu-jin-zhan.html">read more</a></div>
    </div>	
				

 
        

 

    <div class='article'>
        <a href="../pages/2016/05/24/ryuwang-luo-shi-yan-tan-ce-ying-yong.html"><h2>Ryu:网络时延探测应用</h2></a>
        <div class= "well small"> 2016-05-24

by <a class="url fn" href="../author/muzi.html">muzi</a>
 


 </div>
        <div class="summary"><p>之前，笔者已经发布了网络感知应用和基于跳数的最短路径转发应用。本文将介绍笔者开发的网络时延探测应用。该应用通过LLDP数据包的时延和Echo数据包的时延计算得出链路的时延数据，从而实现网络链路时延的感知。详细原理和实现步骤将在文章中详细介绍。</p>
<h3>测试原理</h3>
<p>网络时延探测应用利用了Ryu自带的Switches模块的数据，获取到了LLDP数据发送时的时间戳，然后和收到的时间戳进行相减，得到了LLDP数据包从控制器下发到交换机A，然后从交换机A到交换机B，再上报给控制器的时延T1，示例见图1的蓝色箭头。同理反向的时延T2由绿色的箭头组成。此外，控制器到交换机的往返时延由一个蓝色箭头和一个绿色箭头组成，此部分时延由echo报文测试，分别为Ta，Tb。最后链路的前向后向平均时延T=（T1+T2-Ta-Tb）/2。</p>
<p><center><img alt="link delay" src="http://ww1.sinaimg.cn/mw690/7f593341jw1f40i7d39ouj20fr09lgm6.jpg" /></center>
<center>图1. 测量链路时延原理图</center></p>
<h3>获取LLDP时延</h3>
<p>获取T1和T2的逻辑一样，均需要使用到Switches模块的数据。计算LLDP时延的处理逻辑如下代码所示。首先从Packet_in中解析LLDP数据包，获得源DPID，源端口。然后根据发送端口的数据获取到portdata中的发送时间戳数据，并用当下的系统时间减去发送时间戳，得到时延，最后将其保存到graph数据中。</p>
<div class="highlight"><pre>    <span class="nd">@set_ev_cls</span><span class="p">(</span><span class="n">ofp_event</span><span class="o">.</span><span class="n">EventOFPPacketIn</span><span class="p">,</span> <span class="n">MAIN_DISPATCHER</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">packet_in_handler</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ev</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">ev</span><span class="o">.</span><span class="n">msg</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">src_dpid ...</span></pre></div> <a class="btn btn-info xsmall" href="../pages/2016/05/24/ryuwang-luo-shi-yan-tan-ce-ying-yong.html">read more</a></div>
    </div>	
				
<div class="pagination">
<ul>
    <li class="prev disabled"><a href="#">&larr; Previous</a></li>

    <li class="active"><a href="../category/tech.html">1</a></li>
    <li class=""><a href="../category/tech2.html">2</a></li>
    <li class=""><a href="../category/tech3.html">3</a></li>
    <li class=""><a href="../category/tech4.html">4</a></li>
    <li class=""><a href="../category/tech5.html">5</a></li>
    <li class=""><a href="../category/tech6.html">6</a></li>
    <li class=""><a href="../category/tech7.html">7</a></li>
    <li class=""><a href="../category/tech8.html">8</a></li>
    <li class=""><a href="../category/tech9.html">9</a></li>
    <li class=""><a href="../category/tech10.html">10</a></li>
    <li class=""><a href="../category/tech11.html">11</a></li>
    <li class=""><a href="../category/tech12.html">12</a></li>
    <li class=""><a href="../category/tech13.html">13</a></li>
    <li class=""><a href="../category/tech14.html">14</a></li>
    <li class=""><a href="../category/tech15.html">15</a></li>

    <li class="next"><a href="../category/tech2.html">Next &rarr;</a></li>

</ul>
</div>
 
  
        </div>
        
        <div class="span3">

            <div class="well" style="padding: 8px 0; background-color: #FBFBFB;">
            <ul class="nav nav-list">
                <li class="nav-header"> 
                Site
                </li>
            
                <li><a href="../archives.html">Archives</a>
                <li><a href="../tags.html">Tags</a>
                <!-- <li><a href="http://www.muzixing.com/" rel="alternate">Atom feed</a> -->
		</li>
                <li><a href="http://www.muzixing.com/feeds/all.rss.xml" rel="alternate">RSS feed</a></li>
            </ul>
            </div>


            <div class="well" style="padding: 8px 0; background-color: #FBFBFB;">
            <ul class="nav nav-list">
                <li class="nav-header"> 
                Categories
                </li>
                
                <li><a href="../category/life.html">Life</a></li>
                <li><a href="../category/tech.html">Tech</a></li>
                   
            </ul>
            </div>


            <div class="well" style="padding: 8px 0; background-color: #FBFBFB;">
            <ul class="nav nav-list">
                <li class="nav-header"> 
                Links
                </li>
            
                <li><a href="http://www.sdnlab.com/">SDNLAB</a></li>
                <li><a href="http://www.sdnap.com/">SDNAP</a></li>
                <li><a href="http://www.richardzhao.me/">Richardzhao</a></li>
                <li><a href="http://ikimi.net/">Kimi Yang</a></li>
                <li><a href="http://milestones.lofter.com/">Milestones</a></li>
            </ul>
            </div>


            <div class="social">
            <div class="well" style="padding: 8px 0; background-color: #FBFBFB;">
            <ul class="nav nav-list">
                <li class="nav-header"> 
                Social
                </li>
           
                <li><a href="https://github.com/muzixing">Github</a></li>
                <li><a href="http://weibo.com/u/2136552257">Weibo</a></li>
                <li><a href="http://linkedin.com/profile/view?id=334725834">Linkedin</a></li>
                <li><a href="http://350959853.qzone.qq.com">Qzone</a></li>
            </ul>
            </div>
            </div>

        </div>  
    </div>     </div> 
<footer>
<br />
<p><a href="..">Milestone</a> &copy; muzi 2012</p>
</footer>

</div> <!-- /container -->
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
<script src="http://twitter.github.com/bootstrap/assets/js/bootstrap-collapse.js"></script>
<script>var _gaq=[['_setAccount','UA-45955656-1'],['_trackPageview']];(function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];g.src='//www.google-analytics.com/ga.js';s.parentNode.insertBefore(g,s)}(document,'script'))</script>
 
</body>
</html>