<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="utf-8">
    <title>Milestone</title>
    <meta name="description" content="">
    <meta name="author" content="muzi">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
    <script src="../../../../theme/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
    <link href="../../../../theme/bootstrap.min.css" rel="stylesheet">
    <link href="../../../../theme/bootstrap.min.responsive.css" rel="stylesheet">
    <link href="../../../../theme/local.css" rel="stylesheet">
    <link href="../../../../theme/pygments.css" rel="stylesheet">

</head>

<body>

<div class="navbar">
    <div class="navbar-inner">
    <div class="container">

         <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
             <span class="icon-bar"></span>
             <span class="icon-bar"></span>
             <span class="icon-bar"></span>
         </a>

        <a class="brand" href="../../../..">Milestone</a>

        <div class="nav-collapse">

        <ul class="nav">
            
            <li><a href="../../../../pages/about-me.html">About me</a></li>
        </ul>
	<form class="navbar-search pull-right" action="/search.html">
    	<input type="text" class="search-query" placeholder="Search" name="q" id="s">
</form>

        </div>
        
    </div>
    </div>
</div>

<div class="container">
    <div class="content">
    <div class="row">

        <div class="span9">
    <div class='article'>
        <div class="content-title">
            <h1>我是一个SDN交换机</h1>
2016-05-03

by <a class="url fn" href="../../../../author/muzi.html">muzi</a>
 


        </div>
	
        <div><p>我叫阿飞，是大柳树村的快递小哥。阿飞是大家给我起的名字，因为我送货很快。</p>
<p>我做着普通的工作，拿着普通的工资，没有房子，一直单身，但我知道，只要努力，就能出人头地。要知道，在因特奈特国，识字的人并不是很多。幸亏我还认得一些字，才能成为一名光荣的快递员。很多时候，人们叫我交换机，因为我每天都像机器一样交换着包裹。其他快递元也和我一样机械地交换货物，但我知道：我和外地的快递员不一样。我一直知道。</p>
<p>我和其他的金银岛上的快递员们都学过OpenFlow等软件定义网络（SDN）方向的语言，拿的是SDN专业方向的文凭，但那些岛外的快递员前辈们都是传统的快递员，没有学过方面的知识。那时候没有SDN专业方向，所以他们都需要学OSPF、IS-IS等多种传统语言。而我们只需要学会OpenFlow语言基本就可以上岗了。虽然我们学习的内容减少了，但是我们却需要SDN控制器来指挥快递的转发。</p>
<p>之所以现在出现SDN方向是因为传统的工作模式已经固化，难以应付更多的新业务。一方面，快递员要学习的知识太多，需要学习好多语言才能成为一名光荣的传统快递员，所以学习压力很大，而且学费也太贵。另一方面是传统的语言并没有办法沟通出全局的物流信息，导致有时候快递转发效率太低了。但是在SDN的专业方向里面，快递主管拥有全局的物流信息，通过快递主管管理快递员，告诉我们怎么收发，就可以做到全局的掌控，优化传输效率。担任快递主管的人不仅聪明，还特别好学，经常会去进修一些新的转发逻辑算法来优化我们的工作。</p>
<p>还记得我当快递员的第一天，那是4月29号，星期五，阳光明媚。走在上班的路上，感觉空气都有种淡淡的清香，就像我在华为学院读书时女同桌阿楚的发香。阿楚学习不太好，只学会了二层转发的算法，毕业之后也不知道去哪里工作了。如果能再见一面就好了。就算见不到，写写信也挺好的。</p>
<p>那是我第一次推开我办公室的门，还记得手指第一次接触到那扇被朝阳烤暖的门的那种感觉，37.2度，很舒服。一切都是新的，房子是新的，快递窗口是新的，快递单是新的，工作手册是新的，我是新的，生活，也是新的。</p>
<p>走进房间之后，我拿起桌子上的工作手册，发现里面记录着快递主管的相关信息。原来我的快递主管是Ryu族人，在金银城的114.255.40.2办公大楼的6633房间工作。为了赶紧开始工作，我给他发了一封hello联系信，信中告诉主管我学会的OpenFlow语言的最新版本。我和主管通信的信件和包裹都是重要信息，所以一般由控制网络的专门的快递员转发，不像普通用户的快递那样由我们转发。不过有时候也可以放在一起运输，只不过那样就麻烦一些了。</p>
<p>一转眼的功夫，主管大人就给我回复了一封Hello信，于是我们约好了用1.0版本的OpenFlow语言沟通。就在我读信的时候，又收到控制网络快递员铁柱大哥给我送来的信。我赶忙打开信封，信里提到需要我发简历给主管，他希望了解我的能力，好给我配置工作内容。</p>
<p>我赶紧从我的书包中拿出修改了250遍的简历放在features_reply信封中，然后发给了主管。我想：第一天上班，一定要好好表现，以后才能升职加薪，迎娶白富美，走上机生巅峰。脑海里不禁浮现我成为机生赢家的画面：那是一片充满生机的草地，比当初学院操场那些假草要好看得多。我拉着美丽新娘的手，肉肉的，也暖暖的，但我却看不见她的脸。我慢慢靠近她，企图看清她的脸，似乎有些熟悉，又有些神秘。就在我马上要看清的时候，一阵敲门声把我从幻想中拉了回来。又是主管来的信，这次是一个配置信。我按照配置信，认认真真配置完我的办公室之后，满意地坐在桌子前，傻笑着想继续我的幻想。</p>
<p>谁知第一窗口马上就传进来一件快递，我赶忙查看了一下快递信息：是10.0.0.8发给10.0.0.28的快递。我翻开快递转发本子，却发现转发本子上空空荡荡，正如当时我的脑海一样，一片空白。</p>
<p>“怎么办？第一件快递就不会处理，太丢人了！怎么办！！”我着急地一直跺脚，却不知如何是好。突然我记起来OpenFlow语言的规范里面有提到：如果遇到不知道怎么处理的快递就把给快递主管发Packet_in包裹，附带上快递件。我这才赶忙给快递贴上一个Packet_in信，然后火急火燎地发给了快递主管。</p>
<p>“怎么这么笨！”，我轻轻地抽着嘴巴自责自己。说时迟那时快，快递主管的包裹又到了。那是一个Packet_out包裹，让我赶忙把数据包给进货窗口以外的所有发货窗口都发一份。我立马照做了，虽然不知道为什么，但是我觉得很厉害的样子。</p>
<p>很快的，我又收到了10.0.0.8发给10.0.0.28的另一件快递。因为上次没在记录怎么处理这类型的包裹，所以我只能再一次请快递主管帮忙了。唉，我真是太笨了！眨眼的功夫，主管就给我回复了一个Flow_mod信，信里提到把10.0.0.8发给10.0.0.28的快递都统一送到3窗口。这下我的工作简单了很多，不用再询问主管了。</p>
<p>第一天上班，几乎所有快递都需要主管指导才能完成转发，所以我也忙得不可开交。不过还好，我很快就知道那些快递包裹需要怎么处理了，只要不是新的包裹，我都可以自己处理。</p>
<p>还记得第一天晚上，忙碌了一天的我又兴奋又难过。兴奋的是我终于当上了一名光荣的快递员，在大柳树村，我可是学历最高的人，那些寄信的小姑娘都会对我笑，还有那些大妈都会询问我没有有对象，感觉自己棒棒的。难过的是我觉得自己好笨，什么都要请教主管。</p>
<p>时间如白驹过隙，一转眼，我已经成为一个“老司机”。现在我学会了很多快递处理的规则，基本上都不需要找我们快递主管帮忙了。时光就这样静静地流淌，穿过我忙碌的指缝，穿过地上摆满的快递，一去不返。而我一直在忙碌，也一直是单身。</p>
<p>在没有新货物要处理的时候，我每一天都在忙着把货物从这个窗口收进来，发到另一个窗口。偶尔规则过了有效时间，我就把它删了，重新请教主管大人。有时遇见了新的快递，我也会喜出望外，因为我可以和主管写信沟通，哪怕是工作上的事，有个人陪你聊聊也比一个人孤独工作的好。虽然忙的时候就忘记了时间，但闲下来时，总觉得一个人有些寂（jí）寞。</p>
<p>除了寂寞意外，主管人很好也是我喜欢和ta写信的原因。他回信很快，而且每次看主管发来的信总有种莫名的熟悉，总感觉好像是阿楚写的，无论是字迹，还是语气。唉，不知道阿楚现在过得怎么样，只会二层算法的她是不是找不到工作，还是不是单身。</p>
<p>忙碌总是比清闲要好一些，尤其像我这样孤独的人。忙碌的生活就这么持续着，直到有一天......</p>
<p>那是一个星期五，印象中那天我最后一次看墙上的钟是下午17点47分。屋外乌云密布，电闪雷鸣，眼看着暴风雨就要来了。当最后一丝日光终于被黑云吞噬，屋外开始狂风大作，雷雨交加。狂风像愤怒的狮子一般呼啸着冲向我的办公室，而那些如弹珠般的雨滴就像狮子的攻击一样，疯狂地敲击着我的玻璃窗，似乎想要冲进来摧毁一切。</p>
<p>忙碌的我可管不了太多，我依然认真地转发着快递。就在这时，我发现有一个送往33:33:00:00:00:01地址的包裹不断的从3窗口进来。按照转发手册的处理规则，我把它发往第5窗口。但转眼间，它又回来了，我只能再一次把它转发出去。我逐渐开始意识到它在不断重复出现，而且我发得越快，它回来得就越快。我不断往返与3窗口和5窗口之间，已经无暇顾及其他的快递，堆积在窗外的包裹被雨水打湿，冲走了。渐渐的，我也发现我开始应接不暇了，如果继续这样不断转发下去的话，我一定会倒下的。但是我不能倒下，转发快递是快递员的职责，是快递员的使命！</p>
<p>我依然坚持工作，我的步履开始缓慢，呼吸也变得急促。我觉得有点晕，感觉整个房间也开始旋转，跳跃。我闭着眼，就像进入了一个奇幻的梦境。但这个梦境并不美好，我感到莫名的恐惧。我觉得我开始飘了起来，我睁开眼看见椅子也飘了起来，桌子飘了起来，还有那些转发本子和笔，都飘了起来。屋外还是狂风大作，狂风夹裹着沉重的雨点疯狂地敲击着玻璃窗，砸出无数的水花，让我看不清窗外的景象。突然，一声炸雷，把我从梦境之中拽出来。隐约中我看见窗外不远处的树枝被劈断，断裂处开始着火。但很快，火就被雨水无情地浇灭了。</p>
<p>我还在转发那个从3端口进来的包裹，不知道为什么它到达的速度越来越快，快到我还没有发送它，另一个它又进来了。往返于3窗口和5窗口之间的我，脚底越来越轻，脑海里闪过许多儿时的画面：尿床、亲隔壁小红的脸、偷了老爸的那根香烟......</p>
<p>我突然好像失聪了一样，听不到狂风的呼啸，也听不见雨水攻击窗户的声音，世界突然变得很安静，只剩下呼吸声和心跳，每一次都和我的脚步一样沉重。不知为何，我突然想起了阿楚，还有那个她送我的那个白色橡皮的味道。</p>
<p>“我不能倒下！”， 我暗示自己，我知道这疯狂出现的包裹肯定有问题，肯定有问题！</p>
<p>“我还没有女朋友，我一直努力工作，我不能就这么简单的走了！”我一手扶着墙支撑着自己的身体，一手颤抖着托着快递，挣扎着把它推到第5窗口。</p>
<p>就在包裹马上要被送到窗口时，我倒下了，重重地摔到地板上。但我听不到我倒地的声音，只觉得房子里的光线又暗了一些，让我有些想睡。我挣扎着在地板上蠕动，努力把货物推向第5出货口。我使尽了最后一丝力气，把快递顶了出去。就在这时，一阵强光伴随着一声巨响，我被震到了地上。</p>
<p>我尝试站起来，但是四肢已经没有了感觉。唯一的感觉是寒风一次一次从我的脸上划过，带走我仅剩的一丝温度。我感觉好冷，好冷！又是一次闪电，劈中了我的办公室，我失去了知觉。</p>
<p>那是一个幽暗的森林，没有路，没有风，没有闪电，只有安静伫立着的树，没有声音。茂密的树叶相互遮挡着，看不到一丝天空，幽暗中，我看见不远处的草丛里有一头美丽的鹿。身上的花纹好像母亲最喜欢的衣裳。它看着我，眼里都是的温柔，就像妈妈看我时的模样。我试图靠近，鹿却向森林深处走去，时不时还回头看我，好像在招呼我一样。我在靠近，但我感觉不到青草在我脚下的柔软，感觉不到树叶刮到手臂的疼痛，我感受不到一丝痛苦。</p>
<p>突然一阵电流把我从梦境中惊醒！我以为我很痛，但是我没有。我还是那个我，充满活力，我被重启了。</p>
<p>看着窗外温暖的阳光和充满生机的树林，一切都和以前一样，只是那个被雷劈断的树枝显得格外的刺眼。</p>
<p>我重新开始我的工作，联系我的快递主管Ryu大人，商量通信的语言版本，这次用的是OpenFlow1.3版本的语言。Ryu主管不仅给我发了配置信，还给我发了一个miss-table的处理规则，告诉我把匹配失败的数据包交给他。</p>
<p>使用OpenFlow1.3语言时，我需要使用三种类型的规则小本子，分别叫Flow Table, Group Table和Meter Table。以前我的Flow Table册子就只有单薄的一本，所有货物只要查一次就可以完成处理了。但现在不一样，现在我需要查多本Flow Table的本子，才能完成一个数据包的处理。我这里目前只有5本，听说最多可以支持255本。分成多种本子是因为这样可以做聚类，节省规则数目，我挺喜欢这种方式的。Group Table本子里记录着很多的处理动作集合，大约有select, all, indirect和fast failover四种。Select类型的组表能做负载均衡，all可以做组播indirect可以做聚合，而fast failover能做容灾备份。Meter Table用于计量，虽然有这个规则本子，但是我一般不支持这个，因为太复杂了。这些表单的操作都是我在华为学院读书的时候学的必修课。</p>
<p>除了以上的差别以外，重启之后的我和之前的我在送快递的时候并没有太大区别，每天都在办公室里忙着转发快递，忙着忙着也快忘记了那个黑色星期五发生的事情。后来听说那天是风暴来临，好多个同事都和我一样疯狂地在转发一个数据包，到最后竟活活累死了7个快递小哥，惨绝人寰！还好我身体好才幸免于难。原因竟然只是因为一个新人把送货渠道连成了环路，然后把不知如何处理的数据包给泛洪了，结果就产生了包裹风暴！因为这起事故，主管办公室还换掉了一些员工。唉，都是出来混的，大家都不容易啊。</p>
<p>风暴之后的工作和往常差不多，只不过主管大人现在每个周都会询问我们的业务状况，包括每个端口收发货物的详情，还包括客户之间的快递转发详情。听说收集这个是为了让我们压力均衡一些，不至于出现累死员工的事故。事情是好，但写信的人好像换了，而我不太喜欢他，不论是笔迹，还是语气。</p>
<p>从笔迹和语气上看，给我写转发规则的那个人也换了。没有了当初那种青涩的感觉，多了一些严谨，多了一些犀利，但从字迹上看应该是一个姑娘写的，也许是个御姐。</p>
<p>自从换了人之后，我再也没有收到要把包裹发送给所有窗口的要求了，每一次都是直接发送到指定窗口。其他的快递小哥都喜欢这个新来的人，把她当梦中情人，但我没有。我怀念以前那个给我写规则信的姑娘，无论是字迹，还是语气，因为很像阿楚写的。但世界这么大，哪有这么巧的事情，是我自作多情罢了。</p>
<p>她还好吗？那个笨笨的楚楚姑娘。每个寂寞的夜晚，业务不忙的时候，我总会想起她，想象着她敲响我的窗，正如当年读书的模样。但我并没有遇见她，我遇见的只是跳广场舞的大妈，还有那些艳俗的姑娘，她们只是找我取快递而已，取快递而已。</p>
<p>我叫阿飞，我做着普通的工作，拿着普通的工资，没有房子，一直单身，但我知道，只要努力，就能出人头地。然而风暴之后的我面对那些转发规则信，却再也找不到那种当初的感觉。我觉得我失去了工作的热情，我只是在工作而已，麻木地工作而已。那个御姐，是大家的梦中情人，但不是我的，我怀念的是橡皮擦的清香，还有那个青涩的姑娘。</p>
<p>终于有一天，我正在忙碌的时候，却再也收不到主管给我的回信了。我不断地请求主管，但发出去的信却一封封石沉大海。听控制网络的铁柱说，主管的房间里面没人了。</p>
<p>无奈之下，我只能按照工作手册的指导，把自己切换到了StandAlone模式。在这个模式下，我再也不需要主管控制，我可以自己学习，用二层MAC自学习算法来完成我的工作。二层算法是和阿楚同桌的时候学的，当时我教了她24遍她才会，但就算教会了，第二天她还是过来问我这个算法，好像永远学不会一样。但我知道，她其实会的，只是假装不会而已，而我，也假装以为她不会罢了。</p>
<p>我的生活翻开了新的篇章，需要自己学习，按照规则转发快递。相比之前的工作，工作简单多了，也无聊多了。再也没有人和我聊天，哪怕不见面，写写信也没有。每个周我都让铁柱转发给Ryu主管一封信，但是始终毫无音信，至今已经18年了。我还想着那个叫阿楚的姑娘，不知道现在她是什么模样，是否还有那种发香。我想离开，我想去找她，但我不能，送快递是我的职责，是我的使命。</p>
<p>我叫阿飞，我做着普通的工作，拿着普通的工资，没有房子，一直单身，但我知道，只要努力，就能出人头地。</p>
<h3>作者简介：</h3>
<p>李呈，2014/09-至今，北京邮电大学信息与通信工程学院未来网络理论与应用实验室（FNL实验室）攻读硕士研究生。</p>
<p>个人博客：http://www.muzixing.com</p></div>
	
        <hr>
    	   
        <h2>Comments</h2>
<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'muzixinggithubio'; 
    var disqus_title = '我是一个SDN交换机';

    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    </div>
        </div>
        
        <div class="span3">

            <div class="well" style="padding: 8px 0; background-color: #FBFBFB;">
            <ul class="nav nav-list">
                <li class="nav-header"> 
                Site
                </li>
            
                <li><a href="../../../../archives.html">Archives</a>
                <li><a href="../../../../tags.html">Tags</a>
                <!-- <li><a href="http://www.muzixing.com/" rel="alternate">Atom feed</a> -->
		</li>
                <li><a href="http://www.muzixing.com/feeds/all.rss.xml" rel="alternate">RSS feed</a></li>
            </ul>
            </div>


            <div class="well" style="padding: 8px 0; background-color: #FBFBFB;">
            <ul class="nav nav-list">
                <li class="nav-header"> 
                Categories
                </li>
                
                <li><a href="../../../../category/life.html">Life</a></li>
                <li><a href="../../../../category/tech.html">Tech</a></li>
                   
            </ul>
            </div>


            <div class="well" style="padding: 8px 0; background-color: #FBFBFB;">
            <ul class="nav nav-list">
                <li class="nav-header"> 
                Links
                </li>
            
                <li><a href="http://www.sdnlab.com/">SDNLAB</a></li>
                <li><a href="http://www.sdnap.com/">SDNAP</a></li>
                <li><a href="http://www.richardzhao.me/">Richardzhao</a></li>
                <li><a href="http://ikimi.net/">Kimi Yang</a></li>
                <li><a href="http://milestones.lofter.com/">Milestones</a></li>
            </ul>
            </div>


            <div class="social">
            <div class="well" style="padding: 8px 0; background-color: #FBFBFB;">
            <ul class="nav nav-list">
                <li class="nav-header"> 
                Social
                </li>
           
                <li><a href="https://github.com/muzixing">Github</a></li>
                <li><a href="http://weibo.com/u/2136552257">Weibo</a></li>
                <li><a href="https://www.linkedin.com/in/cheng-li-0b612394">Linkedin</a></li>
                <li><a href="http://350959853.qzone.qq.com">Qzone</a></li>
            </ul>
            </div>
            </div>

        </div>  
    </div>     </div> 
<footer>
<br />
<p><a href="../../../..">Milestone</a> &copy; muzi 2012</p>
</footer>

</div> <!-- /container -->
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
<script src="http://twitter.github.com/bootstrap/assets/js/bootstrap-collapse.js"></script>
<script>var _gaq=[['_setAccount','UA-45955656-1'],['_trackPageview']];(function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];g.src='//www.google-analytics.com/ga.js';s.parentNode.insertBefore(g,s)}(document,'script'))</script>
 
</body>
</html>